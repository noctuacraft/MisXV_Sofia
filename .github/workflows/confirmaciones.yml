name: ğŸ“ Actualizar Confirmaciones Encriptadas

on:
  repository_dispatch:
    types: [nueva_confirmacion]

env:
  GH_TOKEN: ${{ secrets.GH_ACTIONS_TOKEN }}

jobs:
  procesar-confirmacion:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸš€ Checkout del cÃ³digo
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GH_ACTIONS_TOKEN }}
          
      - name: ğŸ” Actualizar y encriptar confirmaciones
        run: |
          # Crear el archivo si no existe
          if [ ! -f confirmaciones.txt ]; then
            echo "ğŸ‰ LISTA DE CONFIRMACIONES XV IARA ğŸ‰" > confirmaciones.txt
            echo "======================================" >> confirmaciones.txt
            echo "Fecha de creaciÃ³n: $(date)" >> confirmaciones.txt
            echo "" >> confirmaciones.txt
          fi
          
          # Agregar nueva confirmaciÃ³n
          echo "ğŸ‘¤ NOMBRE: ${{ github.event.client_payload.confirmacion.nombre }}" >> confirmaciones.txt
          echo "ğŸ“§ EMAIL: ${{ github.event.client_payload.confirmacion.email }}" >> confirmaciones.txt
          echo "âœ… ASISTENCIA: ${{ github.event.client_payload.confirmacion.asistencia }}" >> confirmaciones.txt
          echo "ğŸ‘¥ ACOMPAÃ‘ANTES: ${{ github.event.client_payload.confirmacion.acompanantes }}" >> confirmaciones.txt
          echo "ğŸ“… FECHA: ${{ github.event.client_payload.confirmacion.fecha }}" >> confirmaciones.txt
          echo "-----------------------------------------" >> confirmaciones.txt
          echo "" >> confirmaciones.txt
          
          # Encriptar el archivo
          echo "ğŸ”’ Encriptando archivo..."
          openssl enc -aes-256-cbc -salt -in confirmaciones.txt -out confirmaciones.enc -pass pass:${{ secrets.DO_NOT_STOLE }}
          
          # Configurar Git
          git config --global user.email "actions@github.com"
          git config --global user.name "GitHub Actions Bot"
          
      - name: ğŸ“¤ Subir cambios al repositorio
        run: |
          # Agregar y commitear solo el archivo encriptado
          git add confirmaciones.enc
          git commit -m "ğŸ” Nueva confirmaciÃ³n encriptada - ${{ github.event.client_payload.confirmacion.nombre }}"
          git push origin main