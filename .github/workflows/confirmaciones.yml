name: ðŸ“ Actualizar Confirmaciones Encriptadas

on:
  repository_dispatch:
    types: [nueva_confirmacion]

jobs:
  procesar-confirmacion:
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸš€ Checkout del cÃ³digo
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GH_ACTIONS_TOKEN }}
          
      - name: ðŸ” Actualizar confirmaciones
        run: |
          # Crear el archivo si no existe
          if [ ! -f confirmaciones.txt ]; then
            echo "ðŸŽ‰ LISTA DE CONFIRMACIONES XV SOFÃA ðŸŽ‰" > confirmaciones.txt
            echo "======================================" >> confirmaciones.txt
            echo "" >> confirmaciones.txt
          fi
          
          # Agregar nueva confirmaciÃ³n
          echo "ðŸ‘¤ NOMBRE: ${{ github.event.client_payload.confirmacion.nombre }}" >> confirmaciones.txt
          echo "ðŸ“§ CONTACTO: ${{ github.event.client_payload.confirmacion.email }}" >> confirmaciones.txt
          echo "âœ… ASISTENCIA: ${{ github.event.client_payload.confirmacion.asistencia }}" >> confirmaciones.txt
          echo "ðŸ‘¥ ACOMPAÃ‘ANTES: ${{ github.event.client_payload.confirmacion.acompanantes }}" >> confirmaciones.txt
          echo "âš ï¸ ALERGIAS: ${{ github.event.client_payload.confirmacion.alergias }}" >> confirmaciones.txt
          echo "ðŸ½ï¸ PREFERENCIAS: ${{ github.event.client_payload.confirmacion.preferencias }}" >> confirmaciones.txt
          echo "ðŸ“… FECHA: ${{ github.event.client_payload.confirmacion.fecha }}" >> confirmaciones.txt
          echo "-----------------------------------------" >> confirmaciones.txt
          echo "" >> confirmaciones.txt
          
      - name: ðŸ“¤ Subir cambios
        run: |
          git config --global user.email "actions@github.com"
          git config --global user.name "GitHub Actions"
          git add confirmaciones.txt
          git commit -m "âœ… ConfirmaciÃ³n - ${{ github.event.client_payload.confirmacion.nombre }}"
          git push