name: ğŸ“ Actualizar Confirmaciones Encriptadas

on:
  repository_dispatch:
    types: [nueva_confirmacion]

jobs:
  procesar-confirmacion:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸš€ Checkout del cÃ³digo
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GH_ACTIONS_TOKEN }}
          
      - name: ğŸ” Actualizar confirmaciones
        run: |
          # Crear el archivo si no existe
          if [ ! -f confirmaciones.txt ]; then
            echo "ğŸ‰ LISTA DE CONFIRMACIONES XV SOFÃA ğŸ‰" > confirmaciones.txt
            echo "======================================" >> confirmaciones.txt
            echo "" >> confirmaciones.txt
          fi
          
          # Agregar nueva confirmaciÃ³n
          echo "ğŸ‘¤ NOMBRE: ${{ github.event.client_payload.confirmacion.nombre }}" >> confirmaciones.txt
          echo "ğŸ“§ CONTACTO: ${{ github.event.client_payload.confirmacion.email }}" >> confirmaciones.txt
          echo "âœ… ASISTENCIA: ${{ github.event.client_payload.confirmacion.asistencia }}" >> confirmaciones.txt
          echo "ğŸ‘¥ ACOMPAÃ‘ANTES: ${{ github.event.client_payload.confirmacion.acompanantes }}" >> confirmaciones.txt
          echo "ğŸ“… FECHA: ${{ github.event.client_payload.confirmacion.fecha }}" >> confirmaciones.txt
          echo "-----------------------------------------" >> confirmaciones.txt
          echo "" >> confirmaciones.txt
          
      - name: ğŸ“¤ Subir cambios
        run: |
          git config --global user.email "actions@github.com"
          git config --global user.name "GitHub Actions"
          git add -f confirmaciones.txt  # â† CAMBIÃ‰ ESTA LÃNEA
          git commit -m "âœ… ConfirmaciÃ³n - ${{ github.event.client_payload.confirmacion.nombre }}"
          git push